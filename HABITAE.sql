-- AQUI ESTAMOS CRIANDO AS ENTIDADES E DEFININDO SEUS ATRIBUTOS

CREATE DATABASE HABITAE;
USE HABITAE;
CREATE TABLE EMPRESA (
    CNPJ VARCHAR(15) PRIMARY KEY UNIQUE,
    ID_FUNCIONARIO INT,
    NOME VARCHAR(30),
    TELEFONE VARCHAR(15),
    DEPARTAMENTO VARCHAR(30)
);

CREATE TABLE ANUNCIO (
    ID_ANUNCIO INT PRIMARY KEY UNIQUE,
    ID_IMOVEL INTEGER,
    REDE VARCHAR(20),
    NOME VARCHAR(20),
    VALOR FLOAT
);

CREATE TABLE PAGAMENTO (
    ID_PAGAMENTO INT PRIMARY KEY UNIQUE,
    ID_RESERVA INT,
    ID_USUARIO INT ,
    VALOR FLOAT,
    NOME VARCHAR(30),
    TIPO VARCHAR(30),
    DATA DATE
);

CREATE TABLE FUNCIONARIO (
    ID_FUNCIONARIO INTEGER PRIMARY KEY,
    CPF VARCHAR(14),
    NOME VARCHAR(30),
    TELEFONE VARCHAR(11),
    UNIQUE (ID_FUNCIONARIO, CPF)
);

CREATE TABLE ENDERECO (
    ID_ENDERECO INT PRIMARY KEY UNIQUE,
    CEP INT,
    RUA VARCHAR(100),
    NUMERO VARCHAR(10),
    CIDADE VARCHAR(50),
    ESTADO VARCHAR(2)
);

CREATE TABLE IMOVEL (
    ID_IMOVEL INTEGER PRIMARY KEY UNIQUE,
    ID_ENDERECO INT,
    ID_CLIENTE INT,
    ID_ANUNCIO INT,
    DESCRICAO VARCHAR(255)
);

CREATE TABLE RESERVA (
    ID_RESERVA INT PRIMARY KEY UNIQUE,
    ID_CLIENTE INT,
    ID_IMOVEL INT,
    ID_NOTA INT,
    CHECKIN DATE,
    CHECKOUT DATE
);

CREATE TABLE USUARIO (
    ID_CLIENTE INT PRIMARY KEY UNIQUE,
    NOME VARCHAR(50),
    EMAIL VARCHAR(50),
    TELEFONE VARCHAR(15),
    CPF VARCHAR(14)
);

CREATE TABLE NOTA_FISCAL (
    ID_NOTA INT PRIMARY KEY UNIQUE,
    ID_PAGAMENTO INT,
    VALOR FLOAT,
    NOME VARCHAR(30),
    TIPO VARCHAR(30),
    DATA DATE
);

-- Chamamos a entidade empresa pra começar a trabalhar com a definição das FK's (chaves estrangeiras)
SELECT * FROM EMPRESA;

-- A partir daqui estamos definindo as chaves estrangeiras do banco de dados.
ALTER TABLE EMPRESA
ADD CONSTRAINT FK_EMPRESA_3
FOREIGN KEY (ID_FUNCIONARIO)
REFERENCES FUNCIONARIO(ID_FUNCIONARIO);
 
ALTER TABLE ANUNCIO ADD CONSTRAINT FK_ANUNCIO_3
    FOREIGN KEY (ID_IMOVEL)
    REFERENCES IMOVEL(ID_IMOVEL);
 
ALTER TABLE PAGAMENTO ADD CONSTRAINT FK_PAGAMENTO_3
    FOREIGN KEY (ID_RESERVA)
    REFERENCES RESERVA(ID_RESERVA);
    
SELECT * FROM PAGAMENTO;

ALTER TABLE PAGAMENTO CHANGE COLUMN ID_USUARIO ID_CLIENTE INT;

ALTER TABLE PAGAMENTO ADD CONSTRAINT FK_USUARIO_3
    FOREIGN KEY (ID_CLIENTE)
    REFERENCES USUARIO(ID_CLIENTE);
    
ALTER TABLE IMOVEL ADD CONSTRAINT FK_IMOVEL_4
    FOREIGN KEY (ID_ENDERECO)
    REFERENCES ENDERECO(ID_ENDERECO);
-- here v

ALTER TABLE RESERVA ADD CONSTRAINT FK_RESERVA_3
    FOREIGN KEY (ID_CLIENTE)
    REFERENCES USUARIO(ID_CLIENTE);
 
 ALTER TABLE RESERVA ADD CONSTRAINT FK_RESERVA_4
    FOREIGN KEY (ID_IMOVEL)
    REFERENCES IMOVEL(ID_IMOVEL);
    
ALTER TABLE RESERVA ADD CONSTRAINT FK_RESERVA_5
    FOREIGN KEY (ID_NOTA)
    REFERENCES NOTA_FISCAL(ID_NOTA);
 
ALTER TABLE NOTA_FISCAL ADD CONSTRAINT FK_NOTA_FISCAL_3
    FOREIGN KEY (ID_PAGAMENTO)
    REFERENCES PAGAMENTO(ID_PAGAMENTO);
